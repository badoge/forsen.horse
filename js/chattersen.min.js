function $(e){return document.querySelector(e)}function $$(e){return Array.from(document.querySelectorAll(e))}function showError(e){$("#modalPanicBody").innerHTML=e,modals.error.show()}function sanitize(e=""){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function emotify(e){const t=sanitize(e),a={":)":"_smile"};return t.split(/\s/).map((e=>{const t=a[e]||e;return emotes.includes(t)?`<img src="/pics/emotes/${t}.png" class="chat-emote" title="${e}" data-bs-toggle="tooltip">`:e})).join(" ")}function dateToText(e){return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}function isMobileClient(){let e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function createNodeOfMessage(e={},t=!0){const a=document.createElement("div");a.classList="game-container message-container appear-in";const s=document.createElement("div");s.classList="message-content text-break";const o=document.createElement("span");o.classList="msg-sender";let n=badges.$default;badges.hasOwnProperty(e.channel)&&(n=badges[e.channel].concat(n));let r="";n.forEach((e=>{r+=`<img src="/pics/badges/${e}.png" class="chat-badge" title="${e}">`})),o.innerHTML=r+e.author,s.appendChild(o);const i=document.createElement("span");i.classList="msg-text",i.innerHTML=emotify(e.text);const p=Array.from(i.querySelectorAll("img.chat-emote"));e.tooltips=p.map((e=>new bootstrap.Tooltip(e,{trigger:"hover"}))),s.appendChild(i);const c=document.createElement("div");c.classList="message-content text-break";const l=document.createElement("span");l.classList="badge bg-info message-date text-wrap text-start",t?(l.innerText=dateToText(123456789*Math.random()),l.classList.add("date-unknown")):l.innerText=dateToText(e.date),c.appendChild(l);const d=document.createElement("span");return d.classList="msg-channel",d.innerText=e.channel,c.appendChild(d),a.appendChild(c),a.appendChild(s),$("#game").appendChild(a),a}const modals={error:"#modalPanic",welcome:"#modalWelcome"},badges={forsen:["broadcaster","forsen-7y"],nani:["moderator","nani-4y"],$default:["verified"]},emotes=["BabyRage","EZ","FBCatch","forsen1","forsenBlob","forsenBoshE","forsenBridge","forsenD","forsenE","forsenE1","forsenE2","forsenEE","forsenEZ","forsenGASM","forsenJabroni","forsenKek","forsenKraken","forsenOG","forsenPrime","Kapp","Kappa","LUL","LULE","LULW","OMEGALUL","PagMan","Pepega","Pepepains","Pog","SeemsGood","SnickersHype","xqcL","_smile_"],app={messages:[],pool:[],prev:null,next:null,gameOver:!0,score:0,stats:{games:0,last:0,best:0,avg:0,lastvisit:null},nodes:{buttons:$$("button.game-choice"),controls:$("#gameControls")},src:"/data/chattersen-forsen.txt"};function loadStats(){try{let e=localStorage.getItem("chattersen-stats");e=JSON.parse(e),Object.keys(app.stats).forEach((t=>{e.hasOwnProperty(t)&&(app.stats[t]=e[t])})),app.stats.lastvisit=new Date(app.stats.lastvisit)}catch(e){console.warn("Failed to load stats",e)}}function saveStats(){try{app.stats.lastvisit=new Date,localStorage.setItem("chattersen-stats",JSON.stringify(app.stats))}catch(e){console.warn("Failed to save stats",e)}}function resetGame(){if($("#gameOverArea").style.display="none",app.messages.length<1)return showError("🤔 Who is Forsen?<br>There are no messages from this chatter!");app.nodes.controls.parentElement.removeChild(app.nodes.controls),[app.next,app.prev].forEach((e=>{e&&(e.node&&(e.node.parentElement.removeChild(e.node),delete e.node),e.tooltips&&(e.tooltips.forEach((e=>e.dispose())),delete e.tooltips))})),app.pool=[].concat(app.messages);const e=Math.floor(Math.random()*app.pool.length);return app.next=app.pool.splice(e,1).pop(),app.next.node=createNodeOfMessage(app.next),app.prev={node:null},app.gameOver=!1,app.score=0,$("#score").innerText=app.score,$("#scoreContainer").style.display="",showNextMessage()}function showNextMessage(){delete app.prev.node,app.prev.tooltips&&(app.prev.tooltips.forEach((e=>e.dispose())),delete app.prev.tooltips),app.prev=app.next;const e=app.prev.node.querySelector(".message-date");e.innerText=dateToText(app.prev.date),e.classList.remove("date-unknown");const t=Math.floor(Math.random()*app.pool.length);app.next=app.pool.splice(t,1).pop(),app.pool.length<1&&(app.pool=[].concat(app.messages),app.pool.splice(app.pool.indexOf(app.next),1));const a=createNodeOfMessage(app.next);app.next.node=a,app.nodes.controls.classList.remove("appear-out"),app.nodes.controls.classList.add("appear-in"),app.next.node.appendChild(app.nodes.controls),app.nodes.buttons.forEach((e=>{e.classList.remove("btn-success","btn-danger"),e.classList.add("btn-primary"),e.disabled=!1}))}function userGuess(e){const t=e.currentTarget,a=parseInt(t.dataset.comparator,10);if(isNaN(a))return;app.nodes.buttons.forEach((e=>e.disabled=!0));const s=Math.sign(app.next.date.getTime()-app.prev.date.getTime())||a;t.classList.remove("btn-primary");const o=app.next.node.querySelector(".message-date");o.innerText=dateToText(app.next.date),o.classList.remove("date-unknown"),s===a?(t.classList.add("btn-success"),app.score+=1,$("#score").innerText=app.score,setTimeout((()=>{app.prev.node.classList.remove("appear-in"),app.nodes.controls.classList.remove("appear-in"),app.prev.node.classList.add("appear-out"),app.nodes.controls.classList.add("appear-out"),setTimeout((()=>{$("#game").removeChild(app.prev.node),app.nodes.controls.parentNode.removeChild(app.nodes.controls),showNextMessage()}),500)}),2e3)):(t.classList.add("btn-danger"),gameOver())}function gameOver(){app.gameOver=!0;const e=app.stats.avg*app.stats.games+app.score;app.stats.games+=1,app.stats.last=app.score,app.stats.avg=e/app.stats.games,app.stats.best=Math.max(app.stats.best,app.score),saveStats();const t=["This streak ends at $ point#.","Your total is $.","You got $ point# this time.","You guessed correctly $ time# in a row.","Your final score is $."],a=['<img class="inline-smol" src="/pics/emotes/OMEGALUL.png"> Why are you so bad at this game?','<img class="inline-smol" src="/pics/emotes/LULE.png"> Are you even trying?','<img class="inline-smol" src="/pics/emotes/forsenD.png"> That\'s... okay, I guess.','<img class="inline-smol" src="/pics/emotes/Kappa.png"> Wow, you are so lucky!','<img class="inline-smol" src="/pics/emotes/SeemsGood.png"> Not bad for a rookie!','<img class="inline-smol" src="/pics/emotes/_smile_.png"> Good job!','<img class="inline-smol" src="/pics/emotes/forsenE.png"> That was a good run!','<img class="inline-smol" src="/pics/emotes/EZ.png"> Awesome!','<img class="inline-smol" src="/pics/emotes/PagMan.png"> God gamer!','<img class="inline-smol" src="/pics/emotes/forsenOG.png"> God gamer!'];let s=t[Math.floor(Math.random()*t.length)];s=s.replace("$",`<span class="scoreCounter text-success">${app.score}</span>`);const o=app.score%10==1&&app.score%100!=11?"":"s";s=s.replace("#",o),s+="<br>";let n=Math.ceil(app.score/2);n>=a.length&&(n=a.length-1),s+=a[n],$("#gameOverFlavor").innerHTML=s,$("#gameOverArea").style.display="",$("#gameOverArea").scrollIntoView()}window.onload=function(){Object.keys(modals).forEach((e=>{try{const t=$(modals[e]);modals[e]=new bootstrap.Modal(t)}catch(t){console.error(`Modal [${e}] failed to initialize`,t)}})),fetch(app.src).then((e=>e.text())).then((e=>{const t=e.trim().split(/\r?\n/),a=/^\[([\d\-]+ [\d:]+)\] #(\w+) (\w+): (.+)$/i;let s=0;t.forEach((e=>{try{const t=e.trim().match(a),s={date:t[1],channel:t[2],author:t[3],text:t[4]},o=s.date.split(" "),n=o[0].split("-").map((e=>parseInt(e,10))),r=o[1].split(":").map((e=>parseInt(e,10)));if(s.date=new Date(n[0],n[1]-1,n[2],r[0],r[1],r[2]),isNaN(s.date.getTime()))throw new Error("Invalid date");app.messages.push(s)}catch(e){s+=1}})),s>0&&console.info(`Parser skipped ${s} messages.`),loadStats(),null===app.stats.lastvisit&&(modals.welcome.show(),saveStats()),app.nodes.buttons.forEach((e=>{e.addEventListener("click",userGuess)})),resetGame(),$("#loader").style.display="none",$("#game").style.display=""})).catch((e=>{console.error("Src parsing error",e),showError(`An error occured while we were trying to load the list of messages.<br>Sorry for the inconvenience. Please try again later.<br><br><em>ERROR: ${sanitize(e.message)}</em>`),$("img.loading-placeholder").src="/pics/forsenle/forsenpossessed.gif",$("div.loading-placeholder").innerText="👀 ...nurse? NURSE???"}))},$("#aboutButton").addEventListener("click",(()=>{modals.welcome.show()})),$("#doReset").addEventListener("click",resetGame),$("#doShare").addEventListener("click",(e=>{const t=e.currentTarget,a=t.innerHTML,s=t.clientWidth;t.disabled=!0;let o="🧔⌨️ Chattersen \n";app.stats.games>0&&(o+=`🗿 My last run: ${app.stats.last} \n`,o+=`🧮 In ${app.stats.games} games: \n`,o+=`· Best: ${app.stats.best} Avg: ${app.stats.avg.toFixed(2)} \n`),o+=window.location.origin+window.location.pathname,new Promise(((e,t)=>{try{let a=!1;if(isMobileClient()){let s={text:o};navigator.share&&navigator.canShare&&navigator.canShare(s)&&(a=!0,navigator.share(s).catch((e=>{if(e instanceof Error)switch(e.name){case"AbortError":return;default:throw e}})).then((()=>e("Shared!"))).catch((e=>t(e))))}a||navigator.clipboard.writeText(o).then((()=>e("Copied!"))).catch((e=>t(e)))}catch(e){console.error(e),t(e)}})).then((e=>{t.innerText="✔️ "+e,t.style.width=s+"px",t.classList="btn btn-success"})).catch((e=>{console.warn("Share to clipboard failed",e),t.innerText="❌ Sharing failed!",t.classList="btn btn-warning",window.prompt("Copy this text and send it to your friends:",o)})).then((()=>{setTimeout((()=>{t.innerHTML=a,t.style.width="",t.disabled=!1,t.classList="btn btn-info"}),2323)}))}));