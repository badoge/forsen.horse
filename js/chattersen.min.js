var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,d,c){$jscomp.initSymbolIterator();d=null!=d?d:function(a){return a};var b=[],f=a[Symbol.iterator];if("function"==typeof f)for(a=f.call(a);!(f=a.next()).done;)b.push(d.call(c,f.value));else for(var f=a.length,g=0;g<f;g++)b.push(d.call(c,a[g]));return b}},"es6-impl","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var e=d++;return{value:b(e,a[e]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}};c.prototype.createResolveAndReject_=function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(h){this.reject_(h);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var e=new b;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(k){c.reject(k)}};c.prototype.then=function(a,b){function d(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(m){e(m)}}:b}var f,e,g=new c(function(a,b){f=a;e=b});this.callWhenSettled_(d(a,f),
d(b,e));return g};c.prototype["catch"]=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?e.asyncExecute(c):this.onSettledCallbacks_.push(function(){e.asyncExecute(c)})};c.resolve=function(a){return a instanceof c?a:new c(function(b,c){b(a)})};c.reject=function(a){return new c(function(b,c){c(a)})};
c.race=function(a){return new c(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c.resolve(f.value).callWhenSettled_(b,d)})};c.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c.resolve([]):new c(function(a,e){function f(b){return function(c){h[b]=c;g--;0==g&&a(h)}}var h=[],g=0;do h.push(void 0),g++,c.resolve(d.value).callWhenSettled_(f(h.length-1),e),d=b.next();while(!d.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(c.$jscomp$new$AsyncExecutor=function(){return new b});
return c},"es6-impl","es3");function $(a){return document.querySelector(a)}function $$(a){return Array.from(document.querySelectorAll(a))}function showError(a){$("#modalPanicBody").innerHTML=a;modals.error.show()}function sanitize(a){a=void 0===a?"":a;var b=document.createElement("div");b.innerText=a;return b.innerHTML}
function emotify(a){var b={":)":"_smile"};return sanitize(a).split(/\s/).map(function(a){var c=b[a]||a;return emotes.includes(c)?'<img src="/pics/emotes/'+c+'.png" class="chat-emote" title="'+a+'" data-bs-toggle="tooltip">':a}).join(" ")}function dateToText(a){return(new Date(a)).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}
function isMobileClient(){var a=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))}
function createNodeOfMessage(a,b){a=void 0===a?{}:a;b=void 0===b?!0:b;var d=document.createElement("div");d.classList="game-container message-container appear-in";var c=document.createElement("div");c.classList="message-content text-break";var e=document.createElement("span");e.classList="msg-sender";var f=badges.$default;badges.hasOwnProperty(a.channel)&&(f=badges[a.channel].concat(f));var g="";f.forEach(function(a){g+='<img src="/pics/badges/'+a+'.png" class="chat-badge" title="'+a+'">'});e.innerHTML=g+
a.author;c.appendChild(e);e=document.createElement("span");e.classList="msg-text";e.innerHTML=emotify(a.text);f=Array.from(e.querySelectorAll("img.chat-emote"));a.tooltips=f.map(function(a){return new bootstrap.Tooltip(a)});c.appendChild(e);e=document.createElement("div");e.classList="message-content text-break";f=document.createElement("span");f.classList="badge bg-info message-date text-wrap text-start";b?(f.innerText=dateToText(123456789*Math.random()),f.classList.add("date-unknown")):f.innerText=
dateToText(a.date);e.appendChild(f);f=document.createElement("span");f.classList="msg-channel";f.innerText=a.channel;e.appendChild(f);d.appendChild(e);d.appendChild(c);$("#game").appendChild(d);return d}
var modals={error:"#modalPanic",welcome:"#modalWelcome"},badges={forsen:["broadcaster","forsen-7y"],nani:["moderator","nani-4y"],$default:["verified"]},emotes="BabyRage EZ FBCatch forsen1 forsenBlob forsenBoshE forsenBridge forsenD forsenE forsenE1 forsenE2 forsenEE forsenEZ forsenGASM forsenJabroni forsenKek forsenKraken forsenOG forsenPrime Kapp Kappa LUL LULE LULW OMEGALUL PagMan Pepega Pepepains Pog SeemsGood SnickersHype xqcL _smile_".split(" "),app={messages:[],pool:[],prev:null,next:null,gameOver:!0,
score:0,stats:{games:0,last:0,best:0,avg:0,lastvisit:null},nodes:{buttons:$$("button.game-choice"),controls:$("#gameControls")},src:"/data/chattersen-forsen.txt"};function loadStats(){try{var a=localStorage.getItem("chattersen-stats"),a=JSON.parse(a);Object.keys(app.stats).forEach(function(b){a.hasOwnProperty(b)&&(app.stats[b]=a[b])});app.stats.lastvisit=new Date(app.stats.lastvisit)}catch(b){console.warn("Failed to load stats",b)}}
function saveStats(){try{app.stats.lastvisit=new Date,localStorage.setItem("chattersen-stats",JSON.stringify(app.stats))}catch(a){console.warn("Failed to save stats",a)}}
function resetGame(){$("#gameOverArea").style.display="none";if(1>app.messages.length)return showError("\ud83e\udd14 Who is Forsen?<br>There are no messages from this chatter!");app.nodes.controls.parentElement.removeChild(app.nodes.controls);[app.next,app.prev].forEach(function(a){a&&(a.node&&(a.node.parentElement.removeChild(a.node),delete a.node),a.tooltips&&(a.tooltips.forEach(function(a){return a.dispose()}),delete a.tooltips))});app.pool=[].concat(app.messages);app.next=app.pool.splice(Math.floor(Math.random()*
app.pool.length),1).pop();app.next.node=createNodeOfMessage(app.next);app.prev={node:null};app.gameOver=!1;app.score=0;$("#score").innerText=app.score;$("#scoreContainer").style.display="";return showNextMessage()}
function showNextMessage(){delete app.prev.node;app.prev.tooltips&&(app.prev.tooltips.forEach(function(a){return a.dispose()}),delete app.prev.tooltips);app.prev=app.next;var a=app.prev.node.querySelector(".message-date");a.innerText=dateToText(app.prev.date);a.classList.remove("date-unknown");app.next=app.pool.splice(Math.floor(Math.random()*app.pool.length),1).pop();1>app.pool.length&&(app.pool=[].concat(app.messages),app.pool.splice(app.pool.indexOf(app.next),1));a=createNodeOfMessage(app.next);
app.next.node=a;app.nodes.controls.classList.remove("appear-out");app.nodes.controls.classList.add("appear-in");app.next.node.appendChild(app.nodes.controls);app.nodes.buttons.forEach(function(a){a.classList.remove("btn-success","btn-danger");a.classList.add("btn-primary");a.disabled=!1})}
function userGuess(a){a=a.currentTarget;var b=parseInt(a.dataset.comparator,10);if(!isNaN(b)){app.nodes.buttons.forEach(function(a){return a.disabled=!0});var d=Math.sign(app.next.date.getTime()-app.prev.date.getTime())||b;a.classList.remove("btn-primary");var c=app.next.node.querySelector(".message-date");c.innerText=dateToText(app.next.date);c.classList.remove("date-unknown");d===b?(a.classList.add("btn-success"),app.score+=1,$("#score").innerText=app.score,setTimeout(function(){app.prev.node.classList.remove("appear-in");
app.nodes.controls.classList.remove("appear-in");app.prev.node.classList.add("appear-out");app.nodes.controls.classList.add("appear-out");setTimeout(function(){$("#game").removeChild(app.prev.node);app.nodes.controls.parentNode.removeChild(app.nodes.controls);showNextMessage()},500)},2E3)):(a.classList.add("btn-danger"),gameOver())}}
function gameOver(){app.gameOver=!0;var a=app.stats.avg*app.stats.games+app.score;app.stats.games+=1;app.stats.last=app.score;app.stats.avg=a/app.stats.games;app.stats.best=Math.max(app.stats.best,app.score);saveStats();var b=["This streak ends at $ point#.","Your total is $.","You got $ point# this time.","You guessed correctly $ time# in a row.","Your final score is $."],a='<img class="inline-smol" src="/pics/emotes/OMEGALUL.png"> Why are you so bad at this game?;<img class="inline-smol" src="/pics/emotes/LULE.png"> Are you even trying?;<img class="inline-smol" src="/pics/emotes/forsenD.png"> That\'s... okay, I guess.;<img class="inline-smol" src="/pics/emotes/Kappa.png"> Wow, you are so lucky!;<img class="inline-smol" src="/pics/emotes/SeemsGood.png"> Not bad for a rookie!;<img class="inline-smol" src="/pics/emotes/_smile_.png"> Good job!;<img class="inline-smol" src="/pics/emotes/forsenE.png"> That was a good run!;<img class="inline-smol" src="/pics/emotes/EZ.png"> Awesome!;<img class="inline-smol" src="/pics/emotes/PagMan.png"> God gamer!;<img class="inline-smol" src="/pics/emotes/forsenOG.png"> God gamer!'.split(";"),
b=b[Math.floor(Math.random()*b.length)],b=b.replace("$",'<span class="scoreCounter text-success">'+app.score+"</span>"),b=b.replace("#",1===app.score%10&&11!==app.score%100?"":"s"),d=Math.ceil(app.score/2);d>=a.length&&(d=a.length-1);b=b+"<br>"+a[d];$("#gameOverFlavor").innerHTML=b;$("#gameOverArea").style.display="";$("#gameOverArea").scrollIntoView()}
window.onload=function(){Object.keys(modals).forEach(function(a){try{var b=$(modals[a]);modals[a]=new bootstrap.Modal(b)}catch(d){console.error("Modal ["+a+"] failed to initialize",d)}});fetch(app.src).then(function(a){return a.text()}).then(function(a){var b=/^\[([\d\-]+ [\d:]+)\] #(\w+) (\w+): (.+)$/i,d=0;a.trim().split(/\r?\n/).forEach(function(a){try{var c=a.trim().match(b),f={date:c[1],channel:c[2],author:c[3],text:c[4]},g=f.date.split(" "),h=g[0].split("-").map(function(a){return parseInt(a,
10)}),k=g[1].split(":").map(function(a){return parseInt(a,10)});f.date=new Date(h[0],h[1]-1,h[2],k[0],k[1],k[2]);if(isNaN(f.date.getTime()))throw Error("Invalid date");app.messages.push(f)}catch(l){d+=1}});0<d&&console.info("Parser skipped "+d+" messages.");loadStats();null===app.stats.lastvisit&&(modals.welcome.show(),saveStats());app.nodes.buttons.forEach(function(a){a.addEventListener("click",userGuess)});resetGame();$("#loader").style.display="none";$("#game").style.display=""})["catch"](function(a){console.error("Src parsing error",
a);showError("An error occured while we were trying to load the list of messages.<br>Sorry for the inconvenience. Please try again later."+("<br><br><em>ERROR: "+sanitize(a.message)+"</em>"));$("img.loading-placeholder").src="/pics/forsenle/forsenpossessed.gif";$("div.loading-placeholder").innerText="\ud83d\udc40 ...nurse? NURSE???"})};$("#aboutButton").addEventListener("click",function(){modals.welcome.show()});$("#doReset").addEventListener("click",resetGame);
$("#doShare").addEventListener("click",function(a){var b=a.currentTarget,d=b.innerHTML,c=b.clientWidth;b.disabled=!0;var e="\ud83e\uddd4\u2328\ufe0f Chattersen \n";0<app.stats.games&&(e+="\ud83d\uddff My last run: "+app.stats.last+" \n",e+="\ud83e\uddee In "+app.stats.games+" games: \n",e+="\u00b7 Best: "+app.stats.best+" Avg: "+app.stats.avg.toFixed(2)+" \n");e+=window.location.origin+window.location.pathname;(new Promise(function(a,b){try{var c=!1;if(isMobileClient()){var d={text:e};navigator.share&&
navigator.canShare&&navigator.canShare(d)&&(c=!0,navigator.share(d)["catch"](function(a){if(a instanceof Error)switch(a.name){case "AbortError":break;default:throw a;}}).then(function(){return a("Shared!")})["catch"](function(a){return b(a)}))}c||navigator.clipboard.writeText(e).then(function(){return a("Copied!")})["catch"](function(a){return b(a)})}catch(l){console.error(l),b(l)}})).then(function(a){b.innerText="\u2714\ufe0f "+a;b.style.width=c+"px";b.classList="btn btn-success"})["catch"](function(a){console.warn("Share to clipboard failed",
a);b.innerText="\u274c Sharing failed!";b.classList="btn btn-warning";window.prompt("Copy this text and send it to your friends:",e)}).then(function(){setTimeout(function(){b.innerHTML=d;b.style.width="";b.disabled=!1;b.classList="btn btn-info"},2323)})});
