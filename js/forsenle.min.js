function showError(e){$("#modalPanicBody").html(e),app.modals.error.show()}const app={consts:{hardModeAttempts:6,disparity:{soft:{Date:2,Month:1,FullYear:1},hard:{Date:7,Month:3,FullYear:2}},emojis:{attempt1:"🟢",attempt0:"🔴",correct:"🟩",close:"🟨",far:"🟥",miss:"⬛",prestige:"⭐"},midnightTail:"T00:00:00",daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],datePickerTypeHints:{datetimepicker:"Pick date from a calendar view. Simple, effective, elegant.",flipbox:"Scroll or swipe to select day, month, and year. Includes color coded hints!",date:"Uses native calendar interface to pick date. Visual style may vary - depending on your browser.",text:"Input date as text - manually, with no calendar interface."},datePickerFormats:{"MM-DD-YYYY":"m-d-Y","DD-MM-YYYY":"d-m-Y","YYYY-MM-DD":"Y-m-d"},dateElements:{"YYYY-MM-DD":["FullYear","Month","Date"],"MM-DD-YYYY":["Month","Date","FullYear"],"DD-MM-YYYY":["Date","Month","FullYear"]},nonPrestigeGames:["Games & Demos","Just Chatting","Special Events","Talk Shows & Podcasts"],extraPrestigeSuggestions:["Advance Wars","Adventure","Age of Empires","Age of Empires II","Alone in the Dark","Angry Birds","Animal Crossing","Another World","Archon: The Light and the Dark","Arkanoid","Assassin's Creed II","Asteroids","Baldur's Gate","Baldur's Gate II: Shadows of Amn","Batman: Arkham Asylum","Batman: Arkham City","Battlefield 1942","Battlezone","Bayonetta","Beyond Good & Evil","BioShock","BioShock Infinite","Borderlands","Braid","Bubble Bobble","Burnout 3: Takedown","Burnout Paradise","Call of Duty 2","Call of Duty 4: Modern Warfare","Castlevania: Symphony of the Night","Centipede","Chrono Trigger","Civilization","Civilization II","Civilization IV","Civilization V","Combat","Command & Conquer","Command & Conquer: Red Alert","Company of Heroes","Contra","Contra III: The Alien Wars","Counter-Strike","Crash Bandicoot: Warped","Dance Dance Revolution","Day of the Tentacle","Daytona USA","Defender","Destiny","Deus Ex","Devil May Cry","Devil May Cry 3: Dante's Awakening","Diablo","Diablo II","Donkey Kong","Donkey Kong Country","Doom","Doom II","Double Dragon","Dragon Age: Origins","Dragon Quest VIII","Duke Nukem 3D","Dune II","Dungeon Master","EarthBound","Elite","Eternal Darkness: Sanity's Requiem","EverQuest","Fable II","Fallout","Fallout 2","Fallout 3","Far Cry 3","Final Fantasy IV","Final Fantasy Tactics","Final Fantasy VI","Final Fantasy VII","Final Fantasy X","Final Fight","Fire Emblem: Awakening","Flashback","Frogger","F-Zero GX","Galaga","Gauntlet","Gears of War","Gears of War 2","Ghosts 'n Goblins","God of War","God of War","God of War II","God of War III","GoldenEye 007","Gran Turismo","Gran Turismo 3: A-Spec","Gran Turismo 4","Grand Theft Auto: Vice City","Grim Fandango","Guitar Hero","Gunstar Heroes","Half-Life","Halo 2","Halo 3","Halo: Combat Evolved","Heavy Rain","Hitman: Blood Money","Homeworld","Hotline Miami","Ico","Ikaruga","Indiana Jones and the Fate of Atlantis","Inside","Jet Set Radio","Journey","Joust","Katamari Damacy","Kingdom Hearts","League of Legends","Left 4 Dead","Left 4 Dead 2","Lemmings","LittleBigPlanet","Lode Runner","M.U.L.E.","Marble Madness","Mario Kart 64","Marvel vs. Capcom 2: New Age of Heroes","Mass Effect","Mass Effect 2","Max Payne","Max Payne 2: The Fall of Max Payne","MechWarrior 2: 31st Century Combat","Mega Man 2","Mega Man X","Metal Gear Solid","Metal Gear Solid 2: Sons of Liberty","Metal Gear Solid 3: Snake Eater","Metroid Prime","Micro Machines","Mike Tyson's Punch-Out!!","Missile Command","Monkey Island 2: LeChuck's Revenge","Mortal Kombat","Mortal Kombat II","Ms. Pac-Man","Myst","NBA Jam","Ninja Gaiden","Ōkami","Out Run","Overwatch","Pac-Man","Panzer Dragoon Saga","PaRappa the Rapper","Persona 4","Phantasy Star IV","Phoenix Wright: Ace Attorney","Pitfall!","Planescape: Torment","Plants vs. Zombies","Pokémon Gold and Silver","Pokémon Red and Blue","Pong","Populous","Prince of Persia","Prince of Persia: The Sands of Time","Psychonauts","Quake","Quake II","Quake III: Arena","Red Dead Redemption","Resident Evil","Resident Evil 2","Rez","Ridge Racer","Robotron: 2084","Rock Band","Rock Band 2","Rock Band 3","Rome: Total War","R-Type","Sam & Max Hit the Road","Samurai Shodown","Secret of Mana","Sega Rally Championship","Sensible Soccer","Sensible World of Soccer","Shadow of the Colossus","Shenmue","Shovel Knight","Sid Meier's Pirates!","Silent Hill","Silent Hill 2","SimCity","SimCity 2000","Sonic the Hedgehog","Sonic the Hedgehog 2","Soulcalibur","Soulcalibur II","Space Invaders","Speedball 2: Brutal Deluxe","Spelunky","Star Control II","Star Fox","Star Fox 64","Star Wars Jedi Knight: Dark Forces II","Star Wars: Knights of the Old Republic","Star Wars: TIE Fighter","StarCraft","StarCraft II: Wings of Liberty","Stardew Valley","Street Fighter II","Street Fighter IV","Streets of Rage 2","Suikoden II","Super Castlevania IV","Super Mario 64","Super Mario Bros.","Super Mario Bros. 3","Super Mario Galaxy","Super Mario Galaxy 2","Super Mario Kart","Super Mario World","Super Metroid","Super Smash Bros. Melee","Syndicate","System Shock 2","Team Fortress 2","Tekken 3","Tempest","Tempest 2000","Tetris","The Chronicles of Riddick: Escape from Butcher Bay","The Elder Scrolls III: Morrowind","The Jackbox Party Pack","The Jackbox Party Pack 2","The Jackbox Party Pack 4","The Jackbox Party Pack 9","The Legend of Zelda","The Legend of Zelda: A Link to the Past","The Legend of Zelda: Majora's Mask","The Legend of Zelda: Ocarina of Time","The Legend of Zelda: The Wind Waker","The Legend of Zelda: Twilight Princess","The Oregon Trail","The Secret of Monkey Island","The Sims","The Sims 2","The Witcher 3: Wild Hunt","The World Ends with You","Theme Park","Thief II: The Metal Age","Thief: The Dark Project","Tom Clancy's Splinter Cell","Tom Clancy's Splinter Cell: Chaos Theory","Tomb Raider","Tony Hawk's Pro Skater 2","Tony Hawk's Pro Skater 3","Total Annihilation","Ultima IV: Quest of the Avatar","Ultima Online","Ultima VII: The Black Gate","Uncharted 2: Among Thieves","Uncharted 4: A Thief's End","Unreal Tournament","Valkyria Chronicles","Virtua Fighter 2","Virtua Racing","Warcraft II","WarioWare, Inc.: Mega Microgames!","Wave Race 64","Wii Sports","Wing Commander","Wipeout","Wipeout 2097","Wizardry: Proving Grounds of the Mad Overlord","Wolfenstein 3D","World of Warcraft","Worms","XCOM: Enemy Unknown","X-COM: UFO Defense","Xenoblade Chronicles","Yoshi's Island","Zork"],mediasrc:"/data/forsenle-sources.json",startDate:new Date("2022-05-02T00:00:00")},datePickerOptions:{theme:"default",yearStart:2010,yearEnd:(new Date).getFullYear(),dayOfWeekStart:1,mask:!0,defaultSelect:!1,closeOnDateSelect:!1,validateOnBlur:!1,todayButton:!1,timepicker:!1,onSelectDate:()=>{app.aux.renderAdvice(app.html.controls.inputDate,null)},minDate:void 0,maxDate:void 0,startDate:void 0,format:"Y-m-d"},game:{victory:0,tries:[],issue:0},prestige:{started:!1,guesses:[],issue:0,finished:!1},settings:{dateOrder:(()=>{try{const e=new Intl.DateTimeFormat(navigator.language).formatToParts();switch(e[0].type){case"month":return"MM-DD-YYYY";case"day":return"DD-MM-YYYY";case"year":return"YYYY-MM-DD";default:throw new Error("Cannot define first element of date.",e[0])}}catch(e){return console.warn("Failed to detect locale date format",e),"DD-MM-YYYY"}})(),calendar:!0,inputTypeOverrideHappened:!1,inputType:"legacy",hardMode:!1,zoomImageOnClick:!0,highContrastMode:!1,darkMode:(()=>{try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(e){return!1}})()},announcements:{hardModeOffer:0,highContrastModeAdded:0},stats:{games:0,wins:0,streak:0,min:-1,max:-1,avg:0,pGames:0,pWins:0,pAvg:0,pMin:0,pMax:0,lastissue:0,lastvisit:null},gameGuessList:new Set,currentIssue:0,time:new Date,src:{},target:new Date,min:null,max:null,emojiField:[],modals:{},tooltips:[],popovers:[],html:{countdown:$("span#st_countdown"),loader:{img:$("div#loader img.loading-placeholder"),text:$("div#loader div.loading-placeholder"),container:$("div#loader")},prestige:{counters:$(".prestige-counter"),controls:$("#prestigeControls"),giveUpBtn:$("button#prestigeGiveUp"),inputField:$("#prestigeInputText"),suggestions:$("#prestigeGameOptions"),guesses:$("#prestigeGuessList"),submitBtn:$("button#prestigeSubmit"),container:$("div#prestigeSection"),invite:$("div#prestigeInviteCard"),inviteAcceptBtn:$("#prestigeAcceptBtn"),inviteDeclineBtn:$("#prestigeDeclineBtn"),frameCounter:$("#framePrestige")},game:{frame:$("img#picframe"),controlArea:$("div#userControlArea"),guesses:$("div#mainGameGuessList"),container:$("div#game")},gameinfo:{name:$("div#frameGame"),link:$("a#frameVod"),container:$("div#frameInfoCard")},hardMode:{hmAttemptCounter:$("#hardModeCounter"),container:$("div#mainGameHardModeInfo")},controls:{inputIcon:$("#iCalIcon"),inputDate:$("input#iAttempt"),inputFlip:$("#forsleFlipper"),submitBtn:$("button#iSubmit"),container:$("div#mainGameGuessInput")},buttons:{share:$("#getResultsButton"),about:$("#aboutButton"),stats:$("#statsButton"),settings:$("#settingsButton")},settings:{datefmt:$("select#opt_DateOrderSelect"),calendar:$("#opt_CalendarInput"),calAdvice:$("#calendarAdvice"),hardMode:$("input#opt_HardMode"),highContrastMode:$("input#opt_HighContrastMode"),zoomImageOnClick:$("input#opt_ZoomImageOnClick"),darkMode:$("input#opt_DarkMode")},stats:{congrats:$("#st_statcongrats"),shame:$("#st_statshame"),table:$("#tableWithStats"),tries:$("#st_tries"),games:$("#st_games"),winrate:$("#st_winrate"),streak:$("#st_streak"),min:$("#st_min"),max:$("#st_max"),avgtimes:$("#st_avgtimes"),title:$("#modalVictoryTitle"),prestige:{games:$("#st_p_games"),wins:$("#st_p_wins"),min:$("#st_p_min"),max:$("#st_p_max"),avgtimes:$("#st_p_avgtimes"),title:$("#st_stprestige")}},modals:{error:$("#modalPanic"),welcome:$("#modalWelcome"),stats:$("#modalVictory"),settings:$("#modalSettings")},dynamic:{}},aux:{nullFunction:()=>{},isLeapYear:e=>e%4==0&&e%100!=0||e%400==0,sprinkleSomeLove:(e=1e3)=>{startConfetti(),setTimeout(stopConfetti,e)},hideAllModals:()=>{Object.keys(app.modals).forEach(e=>app.modals[e].hide())},renderNotifications:()=>{if(!app.game.victory){if(!app.announcements.highContrastModeAdded){app.announcements.highContrastModeAdded=new Date,app.aux.save();const e=app.html.buttons.settings;"tooltip"===e.attr("data-bs-toggle")&&(e.tooltip("dispose"),e.removeAttr("title"),e.removeAttr("data-bs-original-title")),e.popover({placement:"bottom",trigger:"manual",content:"🐴 New settings added!"}),e.popover("show");const t=app.html.settings.highContrastMode.parent();t.tooltip({placement:"left",trigger:"manual",title:"🐴 Check this out!"});const a=()=>e.popover("hide");e.on("mouseover",a),e.on("click",()=>{a(),t.tooltip("show")});const p=()=>t.tooltip("dispose");return t.on("mouseover",p),void t.on("click",p)}if(!app.announcements.hardModeOffer&&app.stats.games>5&&app.stats.avg<7){app.announcements.hardModeOffer=new Date,app.aux.save();const e=app.html.buttons.settings;"tooltip"===e.attr("data-bs-toggle")&&(e.tooltip("dispose"),e.removeAttr("title"),e.removeAttr("data-bs-original-title")),e.popover({placement:"bottom",trigger:"manual",html:!0,content:'<img alt="nime" class="inline-smol" src="/pics/forsenle/nime.png" width="18">&nbsp;&nbsp;Game too easy?<br>Try <b>♨️ Hard mode</b>! '}),e.popover("show");const t=()=>e.popover("hide");e.on("mouseover",t),e.on("click",t)}}},renderAdvice:(e,t="")=>{if(t){app.html.dynamic.inputAdviceFriend&&app.html.dynamic.inputAdviceFriend.dispose(),app.html.controls.container.addClass("bad-input");const a=e.is(":visible")?e:e.parent();a.attr("data-bs-content",t),app.html.dynamic.inputAdviceFriend=new bootstrap.Popover(a,{template:'<div class="popover custom-popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header bg-danger"></h3><div class="popover-body bg-danger"></div></div>',html:!0,placement:"bottom",trigger:"manual"}),app.html.dynamic.inputAdviceFriend.show()}else e.attr("data-bs-content",""),e.parent().attr("data-bs-content",""),app.html.controls.container.removeClass("bad-input"),app.html.dynamic.inputAdviceFriend&&(app.html.dynamic.inputAdviceFriend.dispose(),delete app.html.dynamic.inputAdviceFriend)},getTZMidnightDateString:e=>(e instanceof Date||(e=new Date(e)),e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")+app.consts.midnightTail),getUniformedDate:e=>{if(["date","flipbox"].includes(app.settings.inputType))return new Date(e+app.consts.midnightTail);let t=e.split("-");if(3!==t.length)throw new TypeError("Weird date format");const a={};app.consts.dateElements[app.settings.dateOrder].forEach((e,p)=>{if(a[e]=parseInt(t[p],10),isNaN(a[e]))throw new TypeError("Bad date element: "+t[p])});const p=app.aux.isLeapYear(a.FullYear),s=app.consts.daysInMonth;switch(s[1]=p?29:28,!0){case a.FullYear<1:throw new RangeError("Invalid year specified: "+a.FullYear);case a.Month<1||a.Month>12:throw new RangeError("Invalid month specified: "+a.Month);case a.Date<1||a.Date>s[a.Month-1]:throw new RangeError("Invalid day specified: "+a.Date)}return["Month","Date"].forEach(e=>{a[e]=String(a[e]).padStart(2,"0")}),new Date(a.FullYear+"-"+a.Month+"-"+a.Date+app.consts.midnightTail)},updateDatePicker:()=>{"datetimepicker"===app.settings.inputType&&app.html.controls.inputDate.datetimepicker(app.datePickerOptions)},isMobileClient:()=>{let e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))},toggleZoomImageOnClick:(e=!1)=>{app.html.game.frame.parent().removeClass("frame-parent-popout"),app.html.game.controlArea.css("visibility","visible"),app.html.game.frame.parent().toggleClass("frame-expandable",app.settings.zoomImageOnClick),e&&app.html.settings.zoomImageOnClick.prop("checked",app.settings.zoomImageOnClick)},toggleDarkMode:(e=!1)=>{document.documentElement.setAttribute("data-bs-theme",app.settings.darkMode?"dark":"light"),e&&app.html.settings.darkMode.prop("checked",app.settings.darkMode)},toggleHighContrastMode:(e=!1)=>{$("body").toggleClass("high-contrast-colors",app.settings.highContrastMode),e&&app.html.settings.highContrastMode.prop("checked",app.settings.highContrastMode)},toggleCalendarInput:(e=!1)=>{switch("legacy"===app.settings.inputType&&(e=!0,app.settings.inputType=app.settings.calendar?"flipbox":"date"),app.settings.inputType){case"flipbox":app.html.controls.inputIcon.hide(),app.html.controls.inputDate.hide(),app.html.controls.inputFlip.forsleFlipper(app,"init"),app.html.controls.inputFlip.show(),app.html.controls.submitBtn.parent().removeClass("input-group-append-fix"),app.html.controls.container.addClass("user-guess-input-flipbox");break;case"datetimepicker":app.html.controls.inputFlip.hide(),app.html.controls.inputIcon.show(),app.html.controls.inputDate.show(),app.html.controls.submitBtn.parent().addClass("input-group-append-fix"),app.html.controls.container.removeClass("user-guess-input-flipbox"),app.html.controls.inputDate.prop("type","text"),app.html.controls.inputDate.attr("inputmode","none"),app.datePickerOptions.format=app.consts.datePickerFormats[app.settings.dateOrder],app.datePickerOptions.startDate=new Date(app.game.tries[app.game.tries.length-1]||app.time),app.datePickerOptions.minDate=app.min||void 0,app.datePickerOptions.maxDate=app.max||void 0,app.aux.updateDatePicker();break;case"date":case"text":default:app.html.controls.inputFlip.hide(),app.html.controls.inputIcon.show(),app.html.controls.inputDate.show(),app.html.controls.submitBtn.parent().addClass("input-group-append-fix"),app.html.controls.container.removeClass("user-guess-input-flipbox"),app.html.controls.inputDate.datetimepicker("destroy"),app.html.controls.inputDate.prop("type",app.settings.inputType),app.html.controls.inputDate.attr("inputmode","numeric"),app.min&&app.html.controls.inputDate.prop("min",app.min.toISOString().split("T")[0]),app.max&&app.html.controls.inputDate.prop("max",app.max.toISOString().split("T")[0])}app.html.controls.inputDate.val(""),e&&app.html.settings.calendar.val(app.settings.inputType)},applyCustomDateOrder:(e=!1)=>{app.html.controls.inputDate.prop("placeholder",app.settings.dateOrder),"datetimepicker"===app.settings.inputType&&(app.datePickerOptions.format=app.consts.datePickerFormats[app.settings.dateOrder],app.aux.updateDatePicker(),app.html.controls.inputDate.val("")),document.body.dataset.dateOrder=app.settings.dateOrder,e&&app.html.settings.datefmt.val(app.settings.dateOrder)},applyHardModeBlock:(e=!1)=>{if(app.html.hardMode.container[app.settings.hardMode?"show":"hide"](),app.game.tries.length>0&&(app.html.settings.hardMode.prop("disabled",!0),!app.html.dynamic.tooltipOfHardMode)){const e=app.html.settings.hardMode.parent();e.prop("data-bs-title","This can only be changed before the game starts!"),e.attr("data-bs-toggle","tooltip"),e.attr("data-bs-placement","left");const t=new bootstrap.Tooltip(e);app.html.dynamic.tooltipOfHardMode=t,app.tooltips.push(t)}e&&app.html.settings.hardMode.prop("checked",app.settings.hardMode)},clearField:()=>{app.game.tries.length=0,app.game.victory=0,app.html.controls.inputFlip.forsleFlipper(app,"setDate",app.time),"datetimepicker"===app.settings.inputType&&(app.datePickerOptions.startDate=!1,app.aux.updateDatePicker()),app.html.settings.hardMode.prop("disabled",!1),app.prestige.started=!1,app.prestige.finished=!1,app.prestige.guesses.length=0,app.prestige.issue=app.currentIssue},fillHMCounter:()=>{let e="";for(let t=app.consts.hardModeAttempts;t>0;t--)e+=app.consts.emojis[t>app.game.tries.length?"attempt1":"attempt0"];app.html.hardMode.hmAttemptCounter.text(e)},fillSrcInfo:()=>{if(app.src.game?app.html.gameinfo.name.text("🎮 "+app.src.game):app.html.gameinfo.name.text(""),app.src.file&&app.src.file.indexOf("(")<0){const e=String(app.src.file||"").split(".")[0];e?(app.html.gameinfo.link.prop("href","https://youtu.be/"+e),app.html.gameinfo.link.show()):app.html.gameinfo.link.hide()}else app.html.gameinfo.link.hide()},drawAndCheckPrestigeGuess:e=>{if("string"!=typeof e)throw new TypeError("Incorrect type: "+e);const t=e===app.src.game,a=document.createElement("div");return a.classList.add("user-prestige-guess","user-guess-attempt"),a.innerText=(t?"✅":"✖️")+" "+e,app.html.prestige.guesses.append(a),app.html.prestige.counters.text(app.prestige.guesses.length),t},drawAndCheckUserGuess:(e,t=!1)=>{if(!(e instanceof Date))throw new TypeError("Incorrect type: "+e);let a=!0;const p=document.createElement("div");p.classList.add("user-guess-attempt"),app.html.game.guesses.append(p);const s={},i={};["Date","Month","FullYear"].forEach(n=>{const o=document.createElement("div");o.classList.add("ug-element"),o.classList.add("ug-"+n.toLowerCase());let r=e["get"+n]();i[n]=r,"Month"===n&&(r+=1),o.innerText=String(r).padStart(2,"0"),p.appendChild(o);let l=Math.abs(e["get"+n]()-app.target["get"+n]()),m="";t?m="ug-scoots":0===l?(m="ug-correct",s[n]=app.consts.emojis.correct):(a=!1,l<=app.consts.disparity.soft[n]?(m="ug-close",s[n]=app.consts.emojis.close):l<=app.consts.disparity.hard[n]?(m="ug-far",s[n]=app.consts.emojis.far):(m="ug-incorrect",s[n]=app.consts.emojis.miss)),o.classList.add(m),i[n]=[i[n],m]}),app.html.controls.inputFlip.forsleFlipper(app,"colors",i);const n=e<app.target,o=document.createElement("div");if(o.innerText=app.game.tries.length<2?"😎✌️":"🥳",p.appendChild(o),t)o.innerText="♨️";else{if(!a)switch(o.innerText=n?"⏩":"⏪",n&&(!app.min||e.getTime()>=app.min.getTime())&&(app.min=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)),n||app.max&&!(e.getTime()<=app.max.getTime())||(app.max=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1)),app.settings.inputType){case"datetimepicker":app.datePickerOptions.startDate=new Date(e),app.datePickerOptions.minDate=app.min||void 0,app.datePickerOptions.maxDate=app.max||void 0,app.aux.updateDatePicker();break;case"date":app.min&&app.html.controls.inputDate.prop("min",app.min.toISOString().split("T")[0]),app.max&&app.html.controls.inputDate.prop("max",app.max.toISOString().split("T")[0])}s.direction=o.innerText,app.emojiField.push(s)}return o.classList.add("ug-element","ug-direction"),app.aux.fillHMCounter(),a},finalizeGame:(e=2e3)=>{app.aux.fillSrcInfo(),app.html.gameinfo.container.show(),app.html.controls.container.hide(),app.html.hardMode.container.hide(),app.html.game.guesses.show(),app.html.prestige.container.hide(),app.html.prestige.invite.hide(),app.aux.victory(e+1e3*(app.game.victory<0))},load:()=>{try{let e=localStorage.getItem("forsenle-settings");e=JSON.parse(e),Object.keys(app.settings).forEach(t=>{t in e&&(app.settings[t]=e[t])})}catch(e){console.warn("Failed to load game settings",e)}try{let e=localStorage.getItem("forsenle-announcements");e=JSON.parse(e),Object.keys(app.announcements).forEach(t=>{t in e&&(app.announcements[t]=e[t])})}catch(e){console.warn("Failed to load announcements state",e)}try{let e=localStorage.getItem("forsenle-state");e=JSON.parse(e),Object.keys(app.game).forEach(t=>{t in e&&(app.game[t]=e[t])})}catch(e){console.warn("Failed to load game state",e)}try{let e=localStorage.getItem("forsenle-stats");e=JSON.parse(e),Object.keys(app.stats).forEach(t=>{t in e&&(app.stats[t]=e[t])}),app.stats.lastvisit=new Date(app.stats.lastvisit)}catch(e){console.warn("Failed to load stats",e)}try{let e=localStorage.getItem("forsenle-prestige");e=JSON.parse(e),Object.keys(app.prestige).forEach(t=>{t in e&&(app.prestige[t]=e[t])})}catch(e){console.warn("Failed to load prestige state",e)}app.settings.inputTypeOverrideHappened||"datetimepicker"===app.settings.inputType&&(app.settings.inputType="flipbox"),app.settings.inputTypeOverrideHappened=!0,app.aux.toggleDarkMode(!0),app.aux.toggleHighContrastMode(!0),app.aux.applyHardModeBlock(!0),app.aux.applyCustomDateOrder(!0),app.aux.toggleCalendarInput(!0),app.aux.toggleZoomImageOnClick(!0),app.html.settings.calAdvice.text(app.consts.datePickerTypeHints[app.settings.inputType]||app.html.settings.calAdvice.attr("data-fallback-text"))},restoreField:()=>{app.prestige.issue||(app.prestige.finished=!0),app.aux.fillHMCounter(),app.game.tries.forEach((e,t,a)=>{try{if(e.endsWith("Z")){const p=new Date(e),s=app.aux.getTZMidnightDateString(p);a[t]=s,app.aux.drawAndCheckUserGuess(new Date(s))}else app.aux.drawAndCheckUserGuess(new Date(e))}catch(e){console.error("Game state unwrap error",e)}}),!app.game.victory&&app.settings.hardMode&&app.game.tries.length>=app.consts.hardModeAttempts&&(app.game.victory=-1),0!==app.game.victory&&(app.html.prestige.counters.text(app.prestige.guesses.length),app.game.victory<0&&(app.prestige.finished=!0,app.aux.drawAndCheckUserGuess(app.target,!0)),app.html.controls.container.hide(),app.html.hardMode.container.hide(),app.prestige.finished?(app.aux.fillSrcInfo(),app.html.gameinfo.container.show(),app.aux.victory(2e3)):app.prestige.started?(app.prestige.guesses.forEach(e=>{try{app.aux.drawAndCheckPrestigeGuess(e)}catch(e){console.error("Game state unwrap error",e)}}),app.html.game.guesses.hide(),app.html.prestige.container.show()):app.html.prestige.invite.show())},save:()=>{localStorage.setItem("forsenle-state",JSON.stringify(app.game)),localStorage.setItem("forsenle-prestige",JSON.stringify(app.prestige)),localStorage.setItem("forsenle-stats",JSON.stringify(app.stats)),localStorage.setItem("forsenle-settings",JSON.stringify(app.settings)),localStorage.setItem("forsenle-announcements",JSON.stringify(app.announcements))},share:()=>{try{let e="Forsle";if(app.game.victory){e+=` #${app.currentIssue+1} - `,e+=app.game.victory>0?"🧔 in "+app.game.tries.length:"🙅",e+=app.settings.hardMode?" ♨️":"";let t="",a=0;app.emojiField.forEach(p=>{let s="";app.consts.dateElements[app.settings.dateOrder].forEach(e=>{s+=p[e]}),s+=p.direction,t!==s&&(t&&(e+="\n"+t),a>1&&(e+="×"+a),a=0),t=s,a+=1}),t&&(e+="\n"+t),a>1&&(e+="×"+a)}app.prestige.started&&app.prestige.finished&&(e+="\n"+app.consts.emojis.prestige+" Prestige: "+app.prestige.guesses.length);let t=Math.floor(100*app.stats.wins/Math.max(app.stats.games,1));if(e+=`\n🧮 Games: ${app.stats.games} (${t}%, ${app.stats.streak>0?"+":""}${app.stats.streak})`,app.stats.wins>0&&(e+=` Avg: ${app.stats.avg.toFixed(2)} (${app.stats.min}~${app.stats.max})`),e+=`\n${window.location.origin+window.location.pathname}`,!app.game.victory&&app.stats.games<1&&(e="🧔 Forsle\n"+window.location.origin+window.location.pathname),app.aux.isMobileClient()){let t={text:e};if(navigator.share&&navigator.canShare&&navigator.canShare(t))return navigator.share(t).catch(e=>{if(e instanceof Error)switch(e.name){case"AbortError":return;default:throw e}}).then(()=>"Results shared!",e=>{throw e})}return navigator.clipboard.writeText(e).then(()=>"Copied to clipboard!")}catch(e){return console.error(e),Promise.reject(e)}},victory:(e=0)=>{if(0!==app.game.victory){const e=app.game.victory>0;app.html.stats.title.text(e?"🧔 Clone has been identified!":"🤔 Did that stream really happen?"),app.html.stats[e?"congrats":"shame"].show(),app.html.countdown.parent().show()}if(app.game.victory||app.stats.games>0){app.html.stats.tries.text(app.game.tries.length);for(let e in app.stats)if(!/^p[A-Z]/.test(e))switch(e){case"avg":app.html.stats.avgtimes.text(app.stats[e].toFixed(2));break;case"wins":{let e=100*app.stats.wins/Math.max(app.stats.games,1);app.html.stats.winrate.text(Math.floor(e)+"%");break}case"min":case"max":app.html.stats[e].text(app.stats[e]<0?"-":app.stats[e]);break;default:if(!(e in app.html.stats))continue;app.html.stats[e].text(app.stats[e])}}if(app.prestige.started&&app.prestige.finished&&(app.html.prestige.frameCounter.show(),app.html.stats.prestige.title.show()),app.stats.pGames>0){const e=Math.floor(100*app.stats.pWins/app.stats.pGames);app.html.stats.prestige.games.text(app.stats.pGames),app.html.stats.prestige.wins.text(`${app.stats.pWins} (${e.toFixed(0)}%)`),app.html.stats.prestige.avgtimes.text(app.stats.pAvg>0?app.stats.pAvg.toFixed(2):"-"),app.html.stats.prestige.max.text(app.stats.pMax||"-"),app.html.stats.prestige.min.text(app.stats.pMin||"-")}app.html.modals.stats.toggleClass("fade",e>0),setTimeout(()=>{app.game.victory>0&&e>0&&app.aux.sprinkleSomeLove(1e3),e>0&&app.aux.hideAllModals(),app.modals.stats.show()},e)}}};window.onload=function(){Object.keys(app.html.modals).forEach(e=>{app.modals[e]=new bootstrap.Modal(app.html.modals[e])}),app.aux.load(),fetch(app.consts.mediasrc).then(e=>e.json()).then(e=>{if(app.currentIssue=Math.floor((app.time.getTime()-app.consts.startDate.getTime())/864e5),app.currentIssue<0)return app.html.loader.img.prop("src","/pics/forsenle/godseed.gif"),void app.html.loader.text.html("<small><i>Generating god seed...</i></small><br>Your game starts tomorrow!");app.currentIssue!==app.game.issue&&(app.currentIssue-app.stats.lastissue!=1&&(app.stats.streak=0),app.game.issue=app.currentIssue,app.aux.clearField());const t=e.map(e=>e.game);app.gameGuessList=new Set(t.concat(app.consts.extraPrestigeSuggestions).filter(e=>!app.consts.nonPrestigeGames.includes(e)).sort()),app.gameGuessList.forEach(e=>{const t=document.createElement("option");t.value=e,app.html.prestige.suggestions.append(t)}),app.stats.lastvisit?app.aux.renderNotifications():(app.html.modals.welcome.addClass("fade"),app.modals.welcome.show(),app.announcements.highContrastModeAdded=new Date,app.aux.save());const a=app.currentIssue%e.length;app.src=e[a],app.target=new Date(app.src.date.replace("Z","")),app.html.game.frame.prop("src",app.src.link),app.html.game.frame.on("load",()=>{app.aux.restoreField(),app.html.loader.container.hide(),app.html.game.container.show()}),app.html.game.frame.on("error",e=>{console.error("Game image generated an error event!",e),showError('Stream image could not be loaded!<br><br>Try refreshing the page. If this happens again, please <a href="mailto:admin@g7eternal.com?subject=Forsle%20not%20working%20(missing%20image)">notify me</a> about the problem.'),app.html.loader.img.prop("src","/pics/forsenle/forsenpossessed.gif"),app.html.loader.text.html("Clone factory malfunctioning!<br>Please try again later"),app.html.loader.container.show(),app.html.game.container.hide()})}).catch(e=>{console.error("Src parsing error",e);const t=encodeURIComponent(e instanceof Error?e.message:String(e)),a=encodeURIComponent(e instanceof Error?e.name:"Exception"),p=encodeURIComponent(e instanceof Error?e.stack:"(stack not available)");showError("An error occured while retrieving list of stream frames.<br>Try refreshing the page. If this happens again, please "+`<a href="mailto:admin@g7eternal.com?subject=Forsle%20not%20working%20(JSON parse)&body=Error:%20${a}:%20${t}%0D%0A${p}">notify me</a> about the problem.`+`<br><br><em>ERROR: ${decodeURIComponent(t)}</em>`),app.html.loader.img.prop("src","/pics/forsenle/forsenpossessed.gif"),app.html.loader.text.html("Clone factory malfunctioning!<br>Please try again later")});const e=new Date(app.time.getFullYear(),app.time.getMonth(),app.time.getDate()+1),t=setInterval(()=>{let a=Math.floor((e.getTime()-Date.now())/1e3);if(a<0)return clearInterval(t);app.html.countdown.text(`${String(Math.floor(a/3600)).padStart(2,"0")}:${String(Math.floor(a%3600/60)).padStart(2,"0")}:${String(a%60).padStart(2,"0")}`)},1e3);app.html.controls.submitBtn.on("click",e=>{const t=e.currentTarget;t.disabled=!0,"datetimepicker"===app.settings.inputType&&app.html.controls.inputDate.datetimepicker("hide"),app.aux.renderAdvice(app.html.controls.inputDate,null);try{let e=app.html.controls.inputDate.val();if("flipbox"===app.settings.inputType&&(e=app.html.controls.inputFlip.forsleFlipper(app,"getDate")),!e)throw new Error("Please provide a date!");try{if(e=app.aux.getUniformedDate(e),!(e instanceof Date)||isNaN(e))throw new Error("Malformed date")}catch(e){if(console.error("User input parse error",e),"RangeError"===e.name)throw e;throw new Error("Please provide a valid date!")}app.game.tries.push(app.aux.getTZMidnightDateString(e)),app.aux.applyHardModeBlock();const a=app.aux.drawAndCheckUserGuess(e);if(a?app.game.victory=1:app.settings.hardMode&&app.game.tries.length>=app.consts.hardModeAttempts&&(app.game.victory=-1),0!==app.game.victory){app.stats.lastissue=app.currentIssue;let e=app.stats.avg*app.stats.games;app.stats.games+=1,
app.game.victory*app.stats.streak<0&&(app.stats.streak=0),app.stats.streak+=app.game.victory,app.game.victory>0&&(app.stats.wins+=1,app.stats.min<0&&(app.stats.min=app.game.tries.length),app.stats.min=Math.min(app.stats.min,app.game.tries.length),app.stats.max<0&&(app.stats.max=app.game.tries.length),app.stats.max=Math.max(app.stats.max,app.game.tries.length),app.stats.avg=(e+app.game.tries.length)/app.stats.games),app.game.victory<0&&setTimeout(()=>{app.aux.drawAndCheckUserGuess(app.target,!0)},1500);const t=!app.consts.nonPrestigeGames.includes(app.src.game);t&&app.game.victory>0&&app.prestige.issue===app.currentIssue?(app.html.controls.container.hide(),app.html.prestige.invite.show()):(app.prestige.finished=!0,app.aux.finalizeGame())}app.aux.save(),setTimeout(()=>{t.disabled=!1},1e3)}catch(e){console.warn("User submit error",e),app.aux.renderAdvice(app.html.controls.inputDate,String(e.message||e).replace(/\n/g,"<br>")),t.disabled=!1}}),app.html.prestige.inputField.on("keydown",e=>{"Enter"!==e.code&&"NumpadEnter"!==e.code||app.html.prestige.submitBtn.click(),app.aux.renderAdvice(app.html.prestige.inputField,null)}),app.html.controls.inputDate.on("keydown",e=>{"Enter"!==e.code&&"NumpadEnter"!==e.code||app.html.controls.submitBtn.click(),app.aux.renderAdvice(app.html.controls.inputDate,null)}),app.html.buttons.share.on("click",e=>{const t=e.target;t.disabled=!0,app.aux.share().then(e=>{let a=t.innerText;t.innerText="✔️ "+e,t.classList="btn btn-success",setTimeout(()=>{t.innerText=a,t.disabled=!1,t.classList="btn btn-primary"},2323)}).catch(e=>{console.warn("Share to clipboard failed",e),t.innerText="🛑 Sharing failed!",t.classList="btn btn-warning"})}),app.html.buttons.stats.on("click",app.aux.victory),app.html.buttons.settings.on("click",()=>{app.modals.settings.show()}),app.html.buttons.about.on("click",()=>{app.html.modals.welcome.removeClass("fade"),app.modals.welcome.show()}),app.html.game.frame.parent().on("click",()=>{app.settings.zoomImageOnClick&&(app.html.game.frame.parent().toggleClass("frame-parent-popout"),app.html.game.controlArea.css("visibility",(e,t)=>"visible"===t?"hidden":"visible"))}),app.html.prestige.inviteDeclineBtn.on("click",()=>{app.html.prestige.invite.hide(),app.prestige.finished=!0,app.aux.save(),app.aux.finalizeGame(1)}),app.html.prestige.inviteAcceptBtn.on("click",()=>{app.html.prestige.invite.hide(),app.html.game.guesses.hide(),app.prestige.started=!0,app.stats.pGames+=1,app.aux.save(),app.html.prestige.controls.show(),app.html.prestige.container.show()}),app.html.prestige.giveUpBtn.on("click",()=>{app.prestige.started=!1,app.prestige.finished=!0,app.aux.save(),app.html.prestige.controls.hide(),app.aux.finalizeGame(2e3)}),app.html.prestige.inputField.on("input",()=>{app.aux.renderAdvice(app.html.prestige.inputField,null)}),app.html.prestige.submitBtn.on("click",()=>{const e=String(app.html.prestige.inputField.val());if(!e||!app.gameGuessList.has(e))return;if(app.html.prestige.inputField.val(""),app.prestige.guesses.includes(e))return void app.aux.renderAdvice(app.html.prestige.inputField,"You have already tried this one:<br><i>"+e+"</i>");app.prestige.guesses.push(e),app.aux.save();const t=app.aux.drawAndCheckPrestigeGuess(e);if(t){app.prestige.finished=!0;const e=app.prestige.guesses.length,t=app.stats.pAvg*app.stats.pWins;app.stats.pWins+=1,app.stats.pAvg=(t+e)/app.stats.pWins,app.stats.pMax<e&&(app.stats.pMax=e),(0===app.stats.pMin||app.stats.pMin>e)&&(app.stats.pMin=e),app.aux.save(),app.html.prestige.controls.hide(),app.aux.finalizeGame(2e3)}}),app.html.settings.hardMode.on("change",e=>{app.settings.hardMode=e.target.checked,app.aux.save(),app.aux.applyHardModeBlock()}),app.html.settings.darkMode.on("change",e=>{app.settings.darkMode=e.target.checked,app.aux.save(),app.aux.toggleDarkMode()}),app.html.settings.highContrastMode.on("change",e=>{app.settings.highContrastMode=e.target.checked,app.aux.save(),app.aux.toggleHighContrastMode()}),app.html.settings.zoomImageOnClick.on("change",e=>{app.settings.zoomImageOnClick=e.target.checked,app.aux.save(),app.aux.toggleZoomImageOnClick()}),app.html.settings.calendar.on("change",e=>{e.target.value&&(app.settings.inputType=e.target.value,app.aux.save(),app.aux.toggleCalendarInput(),app.html.settings.calAdvice.text(app.consts.datePickerTypeHints[e.target.value]||app.html.settings.calAdvice.attr("data-fallback-text")))}),app.html.settings.datefmt.on("change",e=>{app.settings.dateOrder=e.target.value,app.aux.save(),app.aux.applyCustomDateOrder()});const a=document.querySelectorAll('main [data-bs-toggle="tooltip"]');Array.from(a).forEach(e=>new bootstrap.Tooltip(e))};