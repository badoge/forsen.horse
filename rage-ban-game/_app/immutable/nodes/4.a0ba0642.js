import{s as $,a as C,f as v,$ as A,d as _,c as I,g as b,h as M,H as z,j as c,i as L,r as p,v as D,o as O,l as P,m as U,n as V,u as G,Q as B}from"../chunks/scheduler.42cb3d2e.js";import{S as F,i as Q,b as J,d as K,m as N,a as W,t as X,e as Y}from"../chunks/index.ee22a225.js";import{G as Z,B as R}from"../chunks/GameTitle.3d27aeb8.js";const ee="auto",le=Object.freeze(Object.defineProperty({__proto__:null,prerender:ee},Symbol.toStringTag,{value:"Module"}));function te(i){let t,e='<span class="visually-hidden">Loading...</span>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(n){t=b(n,"DIV",{class:!0,role:!0,"data-svelte-h":!0}),z(t)!=="svelte-dck6nt"&&(t.innerHTML=e),this.h()},h(){c(t,"class","spinner-border text-secondary my-4"),c(t,"role","status")},m(n,o){L(n,t,o)},p:G,d(n){n&&_(t)}}}function ne(i){let t,e,n,o;return{c(){t=v("a"),e=v("img"),o=P(`
      Login with Twitch`),this.h()},l(l){t=b(l,"A",{role:!0,class:!0,href:!0});var s=M(t);e=b(s,"IMG",{src:!0,alt:!0,width:!0,height:!0,class:!0}),o=U(s,`
      Login with Twitch`),s.forEach(_),this.h()},h(){B(e.src,n="/pics/icons/twitch.svg")||c(e,"src",n),c(e,"alt","Twitch"),c(e,"width","36"),c(e,"height","36"),c(e,"class","d-inline-block align-text-top"),c(t,"role","button"),c(t,"class","btn btn-twitch shadow my-4 fs-4 svelte-12o8zwg"),c(t,"href",i[2])},m(l,s){L(l,t,s),p(t,e),p(t,o)},p(l,s){s&4&&c(t,"href",l[2])},d(l){l&&_(t)}}}function S(i){let t,e;return{c(){t=v("div"),e=P(i[0]),this.h()},l(n){t=b(n,"DIV",{class:!0});var o=M(t);e=U(o,i[0]),o.forEach(_),this.h()},h(){c(t,"class","mt-2 text-danger")},m(n,o){L(n,t,o),p(t,e)},p(n,o){o&1&&V(e,n[0])},d(n){n&&_(t)}}}function oe(i){let t,e,n,o,l,s,q="Authorize with Twitch",w,u,k=`If you are streaming,
    <br/>
    please do not show this window.`,m,d,g;o=new Z({});function T(r,y){return r[1]?ne:te}let E=T(i),h=E(i),a=i[0]&&S(i);return{c(){t=C(),e=v("div"),n=v("div"),J(o.$$.fragment),l=C(),s=v("h3"),s.textContent=q,w=C(),u=v("h5"),u.innerHTML=k,m=C(),h.c(),d=C(),a&&a.c(),this.h()},l(r){A("svelte-184u1m8",document.head).forEach(_),t=I(r),e=b(r,"DIV",{class:!0});var f=M(e);n=b(f,"DIV",{class:!0});var H=M(n);K(o.$$.fragment,H),H.forEach(_),l=I(f),s=b(f,"H3",{"data-svelte-h":!0}),z(s)!=="svelte-1ida242"&&(s.textContent=q),w=I(f),u=b(f,"H5",{class:!0,"data-svelte-h":!0}),z(u)!=="svelte-1ab8qqr"&&(u.innerHTML=k),m=I(f),h.l(f),d=I(f),a&&a.l(f),f.forEach(_),this.h()},h(){document.title="Authorization",c(n,"class","title svelte-12o8zwg"),c(u,"class","text-warning mt-2"),c(e,"class","modal-fake svelte-12o8zwg")},m(r,y){L(r,t,y),L(r,e,y),p(e,n),N(o,n,null),p(e,l),p(e,s),p(e,w),p(e,u),p(e,m),h.m(e,null),p(e,d),a&&a.m(e,null),g=!0},p(r,[y]){E===(E=T(r))&&h?h.p(r,y):(h.d(1),h=E(r),h&&(h.c(),h.m(e,d))),r[0]?a?a.p(r,y):(a=S(r),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(r){g||(W(o.$$.fragment,r),g=!0)},o(r){X(o.$$.fragment,r),g=!1},d(r){r&&(_(t),_(e)),Y(o),h.d(),a&&a.d()}}}const j="https://id.twitch.tv/oauth2/authorize?";function x(i){window.opener.postMessage(i,window.location.origin)}function re(i,t,e){let n;D(i,R,u=>e(4,n=u));let o="",l=!1,s=j;const q=["chat:read","channel:moderate","moderation:read","moderator:read:chatters","moderator:manage:banned_users","moderator:manage:warnings"],w={response_type:"token",state:n.csrf,scope:q.join("+"),client_id:n.app,redirect_uri:encodeURIComponent(window.location.origin+window.location.pathname)};return O(()=>{const u=R.subscribe(d=>{w.state=d.csrf,w.client_id=d.app,w.redirect_uri=encodeURIComponent(window.location.origin+window.location.pathname),e(2,s=j+Object.keys(w).map(g=>g+"="+w[g]).join("&"))}),k=window.location.hash||window.location.search;if(!k){e(1,l=!0);return}const m=k.slice(1).split("&").reduce((d,g)=>{const T=g.split("=");return d[decodeURIComponent(T[0])]=decodeURIComponent(T[1])||!0,d},{});try{if(m.state!==n.csrf)throw console.warn("CSRF Token mismatch:",n.csrf,m.state),new Error("State token mismatch. Please refresh the page and try again.");if(m.error)throw new Error(decodeURIComponent(m.error_description||m.error).replace(/\+/g," "));x({type:"auth",result:!0,token:m.access_token}),window.close()}catch(d){console.error("Twitch OAuth failed",d),e(0,o=d.message),e(1,l=!0),x({type:"auth",result:!1,token:null})}return()=>{u()}}),[o,l,s]}class ce extends F{constructor(t){super(),Q(this,t,re,oe,$,{})}}export{ce as component,le as universal};
